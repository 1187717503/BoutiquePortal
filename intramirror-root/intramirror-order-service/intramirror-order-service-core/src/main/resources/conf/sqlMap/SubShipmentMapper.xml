<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.intramirror.common.core.mapper.SubShipmentMapper">
    <resultMap id="BaseResultMap" type="com.intramirror.order.api.model.SubShipment">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <id column="sub_shipment_id" property="subShipmentId" jdbcType="BIGINT"/>
        <result column="shipping_segment_id" property="shippingSegmentId" jdbcType="BIGINT"/>
        <result column="shipment_id" property="shipmentId" jdbcType="BIGINT"/>
        <result column="segment_sequence" property="segmentSequence" jdbcType="BIGINT"/>
        <result column="awb_num" property="awbNum" jdbcType="VARCHAR"/>
        <result column="consignee" property="consignee" jdbcType="VARCHAR"/>
        <result column="contact" property="contact" jdbcType="VARCHAR"/>
        <result column="piva" property="piva" jdbcType="VARCHAR"/>
        <result column="ship_to_addr" property="shipToAddr" jdbcType="VARCHAR"/>
        <result column="ship_to_addr2" property="shipToAddr2" jdbcType="VARCHAR"/>
        <result column="ship_to_addr3" property="shipToAddr3" jdbcType="VARCHAR"/>
        <result column="ship_to_emailAddr" property="shipToEamilAddr" jdbcType="VARCHAR"/>
        <result column="ship_to_district" property="shipToDistrict" jdbcType="VARCHAR"/>
        <result column="ship_to_city" property="shipToCity" jdbcType="VARCHAR"/>
        <result column="ship_to_province" property="shipToProvince" jdbcType="VARCHAR"/>
        <result column="ship_to_country" property="shipToCountry" jdbcType="VARCHAR"/>
        <result column="ship_to_country_code" property="shipToCountryCode" jdbcType="VARCHAR"/>
        <result column="status" property="status" jdbcType="INTEGER"/>
        <result column="created_at" property="createdAt" jdbcType="TIMESTAMP"/>
        <result column="updated_at" property="updatedAt" jdbcType="TIMESTAMP"/>
        <result column="postal_code" property="postalCode" jdbcType="VARCHAR"/>
        <result column="person_name" property="personName" jdbcType="VARCHAR"/>
    </resultMap>
    <sql id="Base_Column_List">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        sub_shipment_id, shipping_segment_id, shipment_id,segment_sequence, awb_num, consignee,person_name,contact,
        piva,ship_to_addr,ship_to_addr2,ship_to_addr3,ship_to_emailAddr,ship_to_district,ship_to_city,
        ship_to_province,ship_to_country,ship_to_country_code,postal_code,status, created_at, updated_at
    </sql>
    <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Long">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select
        <include refid="Base_Column_List"/>
        from sub_shipment
        where sub_shipment_id = #{subShipmentId,jdbcType=BIGINT}
    </select>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        delete from sub_shipment
        where sub_shipment_id = #{subShipmentId,jdbcType=BIGINT}
    </delete>
    <insert id="insert" parameterType="com.intramirror.order.api.model.SubShipment">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into sub_shipment (sub_shipment_id, shipping_segment_id,
        segment_sequence, awb_num, status,
        created_at, updated_at)
        values (#{subShipmentId,jdbcType=BIGINT}, #{shippingSegmentId,jdbcType=VARCHAR},
        #{segmentSequence,jdbcType=BIGINT}, #{awbNum,jdbcType=BIGINT}, #{status,jdbcType=INTEGER},
        #{createdAt,jdbcType=TIMESTAMP}, #{updatedAt,jdbcType=TIMESTAMP})
    </insert>
    <insert id="insertSelective" parameterType="com.intramirror.order.api.model.SubShipment">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into sub_shipment
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="subShipmentId != null">
                sub_shipment_id,
            </if>
            <if test="shippingSegmentId != null">
                shipping_segment_id,
            </if>
            <if test="segmentSequence != null">
                segment_sequence,
            </if>
            <if test="awbNum != null">
                awb_num,
            </if>
            <if test="status != null">
                status,
            </if>
            <if test="createdAt != null">
                created_at,
            </if>
            <if test="updatedAt != null">
                updated_at,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="subShipmentId != null">
                #{subShipmentId,jdbcType=BIGINT},
            </if>
            <if test="shippingSegmentId != null">
                #{shippingSegmentId,jdbcType=VARCHAR},
            </if>
            <if test="segmentSequence != null">
                #{segmentSequence,jdbcType=BIGINT},
            </if>
            <if test="awbNum != null">
                #{awbNum,jdbcType=BIGINT},
            </if>
            <if test="status != null">
                #{status,jdbcType=INTEGER},
            </if>
            <if test="createdAt != null">
                #{createdAt,jdbcType=TIMESTAMP},
            </if>
            <if test="updatedAt != null">
                #{updatedAt,jdbcType=TIMESTAMP},
            </if>
        </trim>
    </insert>
    <update id="updateByPrimaryKeySelective" parameterType="com.intramirror.order.api.model.SubShipment">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update sub_shipment
        <set>
            <if test="shippingSegmentId != null">
                shipping_segment_id = #{shippingSegmentId,jdbcType=VARCHAR},
            </if>
            <if test="segmentSequence != null">
                segment_sequence = #{segmentSequence,jdbcType=BIGINT},
            </if>
            <if test="awbNum != null">
                awb_num = #{awbNum,jdbcType=BIGINT},
            </if>
            <if test="status != null">
                status = #{status,jdbcType=INTEGER},
            </if>
            <if test="createdAt != null">
                created_at = #{createdAt,jdbcType=TIMESTAMP},
            </if>
            <if test="updatedAt != null">
                updated_at = #{updatedAt,jdbcType=TIMESTAMP},
            </if>
        </set>
        where sub_shipment_id = #{subShipmentId,jdbcType=BIGINT}
    </update>
    <update id="updateByPrimaryKey" parameterType="com.intramirror.order.api.model.SubShipment">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update sub_shipment
        set shipping_segment_id = #{shippingSegmentId,jdbcType=VARCHAR},
        segment_sequence = #{segmentSequence,jdbcType=BIGINT},
        awb_num = #{awbNum,jdbcType=BIGINT},
        status = #{status,jdbcType=INTEGER},
        created_at = #{createdAt,jdbcType=TIMESTAMP},
        updated_at = #{updatedAt,jdbcType=TIMESTAMP}
        where sub_shipment_id = #{subShipmentId,jdbcType=BIGINT}
    </update>

    <insert id="insertSubshipment" parameterType="java.util.Map" keyProperty="sub_shipment_id">
        INSERT INTO sub_shipment(shipping_segment_id,segment_sequence,consignee,ship_to_addr,ship_to_addr2,ship_to_addr3,ship_to_emailAddr,
        ship_to_district,ship_to_city,ship_to_province,ship_to_country,`status`,created_at,updated_at,shipment_id,ship_to_country_code,
        contact,postal_code,person_name)
         VALUES(
         #{shippingSegmentId,jdbcType=BIGINT},#{segmentSequence,jdbcType=BIGINT},#{consignee,jdbcType=VARCHAR},
         #{shipToAddr,jdbcType=VARCHAR},#{shipToAddr2,jdbcType=VARCHAR},#{shipToAddr3,jdbcType=VARCHAR},#{shipToEamilAddr,jdbcType=VARCHAR},
         #{shipToDistrict,jdbcType=VARCHAR},#{shipToCity,jdbcType=VARCHAR},
         #{shipToProvince,jdbcType=VARCHAR},#{shipToCountry,jdbcType=VARCHAR},#{status,jdbcType=BIGINT},#{createdAt,jdbcType=TIMESTAMP},#{updatedAt,jdbcType=TIMESTAMP},#{shipmentId,jdbcType=BIGINT},
        #{shipToCountryCode,jdbcType=VARCHAR},#{contact,jdbcType=VARCHAR},#{postalCode,jdbcType=VARCHAR},#{personName,jdbcType=VARCHAR});
  </insert>

    <insert id="insertSubshipmentVO" parameterType="com.intramirror.order.api.model.SubShipment" keyProperty="sub_shipment_id">
        INSERT INTO sub_shipment(shipping_segment_id,segment_sequence,consignee,ship_to_addr,ship_to_addr2,ship_to_addr3,ship_to_emailAddr,
        ship_to_district,ship_to_city,ship_to_province,ship_to_country,`status`
        ,created_at,updated_at,shipment_id,ship_to_country_code,contact,piva,postal_code,person_name)
        VALUES(
        #{shippingSegmentId,jdbcType=BIGINT},#{segmentSequence,jdbcType=BIGINT},#{consignee,jdbcType=VARCHAR},
        #{shipToAddr,jdbcType=VARCHAR},#{shipToAddr2,jdbcType=VARCHAR},#{shipToAddr3,jdbcType=VARCHAR},#{shipToEamilAddr,jdbcType=VARCHAR},
        #{shipToDistrict,jdbcType=VARCHAR},#{shipToCity,jdbcType=VARCHAR},
        #{shipToProvince,jdbcType=VARCHAR},#{shipToCountry,jdbcType=VARCHAR},#{status,jdbcType=BIGINT},#{createdAt,jdbcType=TIMESTAMP},#{updatedAt,jdbcType=TIMESTAMP},#{shipmentId,jdbcType=BIGINT},
        #{shipToCountryCode,jdbcType=VARCHAR},#{contact,jdbcType=VARCHAR},#{piva,jdbcType=VARCHAR},#{postalCode,jdbcType=VARCHAR},#{personName,jdbcType=VARCHAR});
        <selectKey keyProperty="subShipmentId" resultType="java.lang.Long">
            select LAST_INSERT_ID() as subShipmentId
        </selectKey>
    </insert>

    <select id="getSubshipment" resultType="java.lang.Long" parameterType="java.util.Map">
	SELECT sub_shipment_id FROM sub_shipment
    WHERE  segment_sequence=#{segmentSequence,jdbcType=BIGINT}
    AND consignee=#{consignee,jdbcType=VARCHAR} AND ship_to_addr=#{shipToAddr,jdbcType=VARCHAR}
    AND ship_to_emailAddr = #{shipToEamilAddr,jdbcType=VARCHAR} AND postal_code = #{postalCode,jdbcType=VARCHAR}
    AND ship_to_district =#{shipToDistrict,jdbcType=VARCHAR} AND ship_to_city = #{shipToCity,jdbcType=VARCHAR}
    AND ship_to_province= #{shipToProvince,jdbcType=VARCHAR} AND ship_to_country=#{shipToCountry,jdbcType=VARCHAR}
    AND contact = #{contact,jdbcType=VARCHAR} AND ship_to_country_code = #{shipToCountryCode,jdbcType=VARCHAR}
    AND `status` = #{status,jdbcType=BIGINT} AND shipment_id = #{shipmentId,jdbcType=BIGINT}
    ORDER BY created_at DESC LIMIT 1;
</select>

    <delete id="deleteSubShipmentByShipmentId" parameterType="long">
	DELETE FROM sub_shipment
	WHERE shipment_id=#{shipmentId,jdbcType=BIGINT}
</delete>

    <select id="getSubShipmentByShipmentId" resultMap="BaseResultMap" parameterType="java.lang.Long">
        select
        <include refid="Base_Column_List"/>
        from sub_shipment
        where shipment_id = #{shipmentId,jdbcType=BIGINT}
        ORDER by segment_sequence ASC
    </select>
    
    <update id="updateSubShipment" parameterType="java.util.Map">
    	update sub_shipment
		set awb_num = #{awbNo}
		where shipment_id = #{shipmentId,jdbcType=BIGINT} AND segment_sequence = 1
    </update>
    
    <select id="getSubShipmentIdByContainerId" resultMap="BaseResultMap" parameterType="java.util.Map">
    	SELECT ss.* FROM container c
		INNER JOIN shipment spt ON c.shipment_id=spt.shipment_id
		INNER JOIN sub_shipment ss ON ss.shipment_id= spt.shipment_id
		where c.container_id=#{containerId,jdbcType=BIGINT}
    </select>
    
     <update id="updateSubShipmentById" parameterType="java.util.Map">
    	update sub_shipment
		set shipment_id = #{shipmentId,jdbcType=BIGINT}
		where shipment_id = #{shipment_id,jdbcType=BIGINT} and sub_shipment_id=#{subShipmentId,jdbcType=BIGINT} 
    </update>

    <select id="getDHLShipment" resultMap="BaseResultMap" parameterType="map">
        SELECT ss.*,s.ship_from_location_id FROM sub_shipment ss
        INNER JOIN shipment s on ss.shipment_id = s.shipment_id
        WHERE s.shipment_id = #{shipmentId,jdbcType=BIGINT}
        AND ss.segment_sequence = #{sequence,jdbcType=BIGINT}
        limit 1
    </select>
</mapper>