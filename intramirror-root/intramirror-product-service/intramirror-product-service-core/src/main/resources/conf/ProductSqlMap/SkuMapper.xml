<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.intramirror.product.core.mapper.SkuMapper">
    <resultMap id="BaseResultMap" type="com.intramirror.product.api.model.Sku">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <id column="sku_id" jdbcType="BIGINT" property="skuId"/>
        <result column="product_id" jdbcType="BIGINT" property="productId"/>
        <result column="sku_code" jdbcType="VARCHAR" property="skuCode"/>
        <result column="name" jdbcType="VARCHAR" property="name"/>
        <result column="in_price" jdbcType="DECIMAL" property="inPrice"/>
        <result column="price" jdbcType="DECIMAL" property="price"/>
        <result column="created_at" jdbcType="TIMESTAMP" property="createdAt"/>
        <result column="updated_at" jdbcType="TIMESTAMP" property="updatedAt"/>
        <result column="enabled" jdbcType="BIT" property="enabled"/>
        <result column="retail_price" jdbcType="DECIMAL" property="retailPrice"/>
        <result column="im_price" jdbcType="DECIMAL" property="imPrice"/>
        <result column="full_modify_date" jdbcType="TIMESTAMP" property="fullModifyDate"/>
        <result column="last_check" jdbcType="TIMESTAMP" property="lastCheck"/>
        <result column="size" jdbcType="VARCHAR" property="size"/>
    </resultMap>
    <sql id="Base_Column_List">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        sku_id, product_id, sku_code, name, in_price, price, created_at, updated_at, enabled,
        retail_price, im_price, full_modify_date, last_check, size
    </sql>
    <sql id="Blob_Column_List">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        coverpic, introduction
    </sql>
    <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select
        <include refid="Base_Column_List"/>
        ,
        <include refid="Blob_Column_List"/>
        from sku
        where sku_id = #{skuId,jdbcType=BIGINT}
    </select>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        delete from sku
        where sku_id = #{skuId,jdbcType=BIGINT}
    </delete>
    <insert id="insert" parameterType="com.intramirror.product.api.model.Sku">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into sku (sku_id, product_id, sku_code,
        name, in_price, price,
        created_at, updated_at, enabled,
        retail_price, im_price, full_modify_date,
        last_check, size, coverpic,
        introduction)
        values (#{skuId,jdbcType=BIGINT}, #{productId,jdbcType=BIGINT}, #{skuCode,jdbcType=VARCHAR},
        #{name,jdbcType=VARCHAR}, #{inPrice,jdbcType=DECIMAL}, #{price,jdbcType=DECIMAL},
        #{createdAt,jdbcType=TIMESTAMP}, #{updatedAt,jdbcType=TIMESTAMP}, #{enabled,jdbcType=BIT},
        #{retailPrice,jdbcType=DECIMAL}, #{imPrice,jdbcType=DECIMAL}, #{fullModifyDate,jdbcType=TIMESTAMP},
        #{lastCheck,jdbcType=TIMESTAMP}, #{size,jdbcType=VARCHAR}, #{coverpic,jdbcType=LONGVARCHAR},
        #{introduction,jdbcType=LONGVARCHAR})
    </insert>
    <insert id="insertSelective" parameterType="com.intramirror.product.api.model.Sku">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into sku
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="skuId != null">
                sku_id,
            </if>
            <if test="productId != null">
                product_id,
            </if>
            <if test="skuCode != null">
                sku_code,
            </if>
            <if test="name != null">
                name,
            </if>
            <if test="inPrice != null">
                in_price,
            </if>
            <if test="price != null">
                price,
            </if>
            <if test="createdAt != null">
                created_at,
            </if>
            <if test="updatedAt != null">
                updated_at,
            </if>
            <if test="enabled != null">
                enabled,
            </if>
            <if test="retailPrice != null">
                retail_price,
            </if>
            <if test="imPrice != null">
                im_price,
            </if>
            <if test="fullModifyDate != null">
                full_modify_date,
            </if>
            <if test="lastCheck != null">
                last_check,
            </if>
            <if test="size != null">
                size,
            </if>
            <if test="coverpic != null">
                coverpic,
            </if>
            <if test="introduction != null">
                introduction,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="skuId != null">
                #{skuId,jdbcType=BIGINT},
            </if>
            <if test="productId != null">
                #{productId,jdbcType=BIGINT},
            </if>
            <if test="skuCode != null">
                #{skuCode,jdbcType=VARCHAR},
            </if>
            <if test="name != null">
                #{name,jdbcType=VARCHAR},
            </if>
            <if test="inPrice != null">
                #{inPrice,jdbcType=DECIMAL},
            </if>
            <if test="price != null">
                #{price,jdbcType=DECIMAL},
            </if>
            <if test="createdAt != null">
                #{createdAt,jdbcType=TIMESTAMP},
            </if>
            <if test="updatedAt != null">
                #{updatedAt,jdbcType=TIMESTAMP},
            </if>
            <if test="enabled != null">
                #{enabled,jdbcType=BIT},
            </if>
            <if test="retailPrice != null">
                #{retailPrice,jdbcType=DECIMAL},
            </if>
            <if test="imPrice != null">
                #{imPrice,jdbcType=DECIMAL},
            </if>
            <if test="fullModifyDate != null">
                #{fullModifyDate,jdbcType=TIMESTAMP},
            </if>
            <if test="lastCheck != null">
                #{lastCheck,jdbcType=TIMESTAMP},
            </if>
            <if test="size != null">
                #{size,jdbcType=VARCHAR},
            </if>
            <if test="coverpic != null">
                #{coverpic,jdbcType=LONGVARCHAR},
            </if>
            <if test="introduction != null">
                #{introduction,jdbcType=LONGVARCHAR},
            </if>
        </trim>
    </insert>
    <update id="updateByPrimaryKeySelective" parameterType="com.intramirror.product.api.model.Sku">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update sku
        <set>
            <if test="productId != null">
                product_id = #{productId,jdbcType=BIGINT},
            </if>
            <if test="skuCode != null">
                sku_code = #{skuCode,jdbcType=VARCHAR},
            </if>
            <if test="name != null">
                name = #{name,jdbcType=VARCHAR},
            </if>
            <if test="inPrice != null">
                in_price = #{inPrice,jdbcType=DECIMAL},
            </if>
            <if test="price != null">
                price = #{price,jdbcType=DECIMAL},
            </if>
            <if test="createdAt != null">
                created_at = #{createdAt,jdbcType=TIMESTAMP},
            </if>
            <if test="updatedAt != null">
                updated_at = #{updatedAt,jdbcType=TIMESTAMP},
            </if>
            <if test="enabled != null">
                enabled = #{enabled,jdbcType=BIT},
            </if>
            <if test="retailPrice != null">
                retail_price = #{retailPrice,jdbcType=DECIMAL},
            </if>
            <if test="imPrice != null">
                im_price = #{imPrice,jdbcType=DECIMAL},
            </if>
            <if test="fullModifyDate != null">
                full_modify_date = #{fullModifyDate,jdbcType=TIMESTAMP},
            </if>
            <if test="lastCheck != null">
                last_check = #{lastCheck,jdbcType=TIMESTAMP},
            </if>
            <if test="size != null">
                size = #{size,jdbcType=VARCHAR},
            </if>
            <if test="coverpic != null">
                coverpic = #{coverpic,jdbcType=LONGVARCHAR},
            </if>
            <if test="introduction != null">
                introduction = #{introduction,jdbcType=LONGVARCHAR},
            </if>
        </set>
        where sku_id = #{skuId,jdbcType=BIGINT}
    </update>
    <update id="updateByPrimaryKey" parameterType="com.intramirror.product.api.model.Sku">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update sku
        set product_id = #{productId,jdbcType=BIGINT},
        sku_code = #{skuCode,jdbcType=VARCHAR},
        name = #{name,jdbcType=VARCHAR},
        in_price = #{inPrice,jdbcType=DECIMAL},
        price = #{price,jdbcType=DECIMAL},
        created_at = #{createdAt,jdbcType=TIMESTAMP},
        updated_at = #{updatedAt,jdbcType=TIMESTAMP},
        enabled = #{enabled,jdbcType=BIT},
        retail_price = #{retailPrice,jdbcType=DECIMAL},
        im_price = #{imPrice,jdbcType=DECIMAL},
        full_modify_date = #{fullModifyDate,jdbcType=TIMESTAMP},
        last_check = #{lastCheck,jdbcType=TIMESTAMP},
        size = #{size,jdbcType=VARCHAR}
        where sku_id = #{skuId,jdbcType=BIGINT}
    </update>

    <sql id="selectColumn">
    sku_id, product_id, sku_code, name,coverpic, introduction, in_price, price, created_at, updated_at, enabled,
    retail_price
  </sql>
    <sql id="selectTable">
    sku s
  </sql>

    <select id="getSkuBySkuCodeAndEnabled" resultMap="BaseResultMap">
        SELECT
        <include refid="selectColumn"/>
        FROM
        <include refid="selectTable"/>
        WHERE
        s.sku_code=#{skuCode}
        AND
        s.enabled=#{enabled}
    </select>

    <select id="getSkuInfoBySkuId" resultType="java.util.HashMap">
        SELECT s.in_price,s.price, sps.sale_price, s.im_price
        FROM sku s LEFT JOIN shop_product_sku sps ON sps.sku_id = s.sku_id
        WHERE sps.shop_product_sku_id = #{shopProductSkuId}
    </select>

    <select id="getSkuById" resultMap="BaseResultMap">
        SELECT
        <include refid="selectColumn"/>
        FROM
        <include refid="selectTable"/>
        WHERE
        s.sku_id=#{skuId}
        AND
        s.enabled=1
    </select>


    <select id="getSkuInfoBySkuCode" parameterType="java.util.Map" resultType="java.util.HashMap">
        SELECT s.sku_id,s.sku_code,p.product_id,p.product_code,pspv.`value` as size
        FROM sku s
        INNER JOIN sku_property skup on (skup.sku_id = s.sku_id and skup.enabled = 1)
        INNER JOIN product p ON (s.product_id = p.product_id and p.enabled = 1)
        INNER JOIN product_sku_property_key pspk ON (
        pspk.product_id = p.product_id
        and pspk.product_sku_property_key_id = skup.product_sku_property_key_id
        and pspk.enabled = 1
        )
        INNER JOIN product_sku_property_value pspv ON (
        pspv.product_sku_property_key_id = skup.product_sku_property_key_id
        and pspv.product_sku_property_value_id = skup.product_sku_property_value_id
        and pspv.enabled = 1
        )
        INNER JOIN vendor v ON (p.vendor_id = v.vendor_id and v.enabled = 1)

        WHERE v.vendor_id = #{vendorId,jdbcType=BIGINT}  AND s.sku_code =#{skuCode};

    </select>

    <select id="listSkuInfoByProductId" resultMap="BaseResultMap">
      SELECT * FROM sku WHERE product_id = #{productId} and enabled = TRUE
    </select>



</mapper>