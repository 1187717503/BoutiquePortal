<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.intramirror.product.core.mapper.BlockMapper">
    <resultMap id="BaseResultMap" type="com.intramirror.product.api.model.Block">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <id column="block_id" jdbcType="BIGINT" property="blockId"/>
        <result column="block_name" jdbcType="VARCHAR" property="blockName"/>
        <result column="status" jdbcType="TINYINT" property="status"/>
        <result column="title" jdbcType="VARCHAR" property="title"/>
        <result column="title_english" jdbcType="VARCHAR" property="titleEnglish"/>
        <result column="subtitle" jdbcType="VARCHAR" property="subtitle"/>
        <result column="bg_color" jdbcType="CHAR" property="bgColor"/>
        <result column="text_color" jdbcType="CHAR" property="textColor"/>
        <result column="sort_order" jdbcType="INTEGER" property="sortOrder"/>
        <result column="create_at" jdbcType="TIMESTAMP" property="createAt"/>
        <result column="modified_at" jdbcType="TIMESTAMP" property="modifiedAt"/>
        <result column="enabled" jdbcType="BIT" property="enabled"/>
        <result column="cover_img" jdbcType="VARCHAR" property="coverImg"/>
    </resultMap>
    <resultMap extends="BaseResultMap" id="ResultMapWithBLOBs" type="com.intramirror.product.api.model.Block">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <result column="content" jdbcType="LONGVARBINARY" property="content"/>
    </resultMap>
    <sql id="Base_Column_List">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        block_id, block_name, status, title, title_english, subtitle, bg_color, text_color, sort_order,
        create_at, modified_at, enabled, cover_img
    </sql>
    <sql id="Blob_Column_List">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        content
    </sql>
    <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="ResultMapWithBLOBs">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select
        <include refid="Base_Column_List"/>
        ,
        <include refid="Blob_Column_List"/>
        from block
        where block_id = #{blockId,jdbcType=BIGINT}
    </select>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        DELETE FROM block
        WHERE block_id = #{blockId,jdbcType=BIGINT}
    </delete>
    <insert id="insert" parameterType="com.intramirror.product.api.model.Block">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        INSERT INTO block (block_id, block_name, status,
        title, title_english, subtitle,
        bg_color, text_color, sort_order, create_at,
        modified_at, enabled, cover_img,
        content)
        VALUES (#{blockId,jdbcType=BIGINT}, #{blockName,jdbcType=VARCHAR}, #{status,jdbcType=TINYINT},
        #{title,jdbcType=VARCHAR}, #{titleEnglish,jdbcType=VARCHAR}, #{subtitle,jdbcType=VARCHAR},
        #{bgColor,jdbcType=CHAR},#{textColor,jdbcType=CHAR}, #{sortOrder,jdbcType=INTEGER}, #{createAt,jdbcType=TIMESTAMP},
        #{modifiedAt,jdbcType=TIMESTAMP}, #{enabled,jdbcType=BIT}, #{coverImg,jdbcType=VARCHAR},
        #{content,jdbcType=LONGVARBINARY})
    </insert>
    <insert id="insertSelective" useGeneratedKeys="true" keyProperty="blockId" keyColumn="block_id" parameterType="com.intramirror.product.api.model.Block">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into block
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="blockId != null">
                block_id,
            </if>
            <if test="blockName != null">
                block_name,
            </if>
            <if test="status != null">
                status,
            </if>
            <if test="title != null">
                title,
            </if>
            <if test="titleEnglish != null">
                title_english,
            </if>
            <if test="subtitle != null">
                subtitle,
            </if>
            <if test="bgColor != null">
                bg_color,
            </if>
            <if test="textColor != null">
                text_color,
            </if>
            <if test="sortOrder != null">
                sort_order,
            </if>
            <if test="createAt != null">
                create_at,
            </if>
            <if test="modifiedAt != null">
                modified_at,
            </if>
            <if test="enabled != null">
                enabled,
            </if>
            <if test="coverImg != null">
                cover_img,
            </if>
            <if test="content != null">
                content,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="blockId != null">
                #{blockId,jdbcType=BIGINT},
            </if>
            <if test="blockName != null">
                #{blockName,jdbcType=VARCHAR},
            </if>
            <if test="status != null">
                #{status,jdbcType=TINYINT},
            </if>
            <if test="title != null">
                #{title,jdbcType=VARCHAR},
            </if>
            <if test="titleEnglish != null">
                #{titleEnglish,jdbcType=VARCHAR},
            </if>
            <if test="subtitle != null">
                #{subtitle,jdbcType=VARCHAR},
            </if>
            <if test="bgColor != null">
                #{bgColor,jdbcType=CHAR},
            </if>
            <if test="textColor != null">
                #{textColor,jdbcType=CHAR},
            </if>
            <if test="sortOrder != null">
                #{sortOrder,jdbcType=INTEGER},
            </if>
            <if test="createAt != null">
                #{createAt,jdbcType=TIMESTAMP},
            </if>
            <if test="modifiedAt != null">
                #{modifiedAt,jdbcType=TIMESTAMP},
            </if>
            <if test="enabled != null">
                #{enabled,jdbcType=BIT},
            </if>
            <if test="coverImg != null">
                #{coverImg,jdbcType=VARCHAR},
            </if>
            <if test="content != null">
                #{content,jdbcType=LONGVARBINARY},
            </if>
        </trim>
    </insert>

    <update id="updateByPrimaryKeyWithBLOBs" parameterType="com.intramirror.product.api.model.Block">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        UPDATE block
        SET block_name = #{blockName,jdbcType=VARCHAR},
        status = #{status,jdbcType=TINYINT},
        title = #{title,jdbcType=VARCHAR},
        title_english = #{titleEnglish,jdbcType=VARCHAR},
        subtitle = #{subtitle,jdbcType=VARCHAR},
        bg_color = #{bgColor,jdbcType=CHAR},
        text_color = #{textColor,jdbcType=CHAR},
        sort_order = #{sortOrder,jdbcType=INTEGER},
        create_at = #{createAt,jdbcType=TIMESTAMP},
        modified_at = #{modifiedAt,jdbcType=TIMESTAMP},
        enabled = #{enabled,jdbcType=BIT},
        cover_img = #{coverImg,jdbcType=VARCHAR},
        content = #{content,jdbcType=LONGVARBINARY}
        WHERE block_id = #{blockId,jdbcType=BIGINT}
    </update>
    <update id="updateByPrimaryKey" parameterType="com.intramirror.product.api.model.Block">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        UPDATE block
        SET block_name = #{blockName,jdbcType=VARCHAR},
        status = #{status,jdbcType=TINYINT},
        title = #{title,jdbcType=VARCHAR},
        title_english = #{titleEnglish,jdbcType=VARCHAR},
        subtitle = #{subtitle,jdbcType=VARCHAR},
        bg_color = #{bgColor,jdbcType=CHAR},
        text_color = #{textColor,jdbcType=CHAR},
        sort_order = #{sortOrder,jdbcType=INTEGER},
        create_at = #{createAt,jdbcType=TIMESTAMP},
        modified_at = #{modifiedAt,jdbcType=TIMESTAMP},
        enabled = #{enabled,jdbcType=BIT},
        cover_img = #{coverImg,jdbcType=VARCHAR}
        WHERE block_id = #{blockId,jdbcType=BIGINT}
    </update>


    <update id="updateByBlockId" parameterType="com.intramirror.product.api.model.Block">

        update block
        <set>
            <if test="blockName != null">
                block_name = #{blockName,jdbcType=VARCHAR},
            </if>
            <if test="status != null">
                status = #{status,jdbcType=TINYINT},
            </if>
            <if test="title != null">
                title = #{title,jdbcType=VARCHAR},
            </if>
            <if test="createAt != null">
                create_at = #{createAt,jdbcType=TIMESTAMP},
            </if>
            modified_at = now(),
            <if test="bgColor != null">
                bg_color = #{bgColor,jdbcType=CHAR},
            </if>
            <if test="textColor != null">
                text_color = #{textColor,jdbcType=CHAR},
            </if>
            <if test="sortOrder != null">
                sort_order = #{sortOrder,jdbcType=INTEGER},
            </if>
            <if test="subtitle != null">
                subtitle = #{subtitle,jdbcType=VARCHAR},
            </if>
            <if test="titleEnglish != null">
                title_english = #{titleEnglish,jdbcType=VARCHAR},
            </if>
            <if test="enabled != null">
                enabled = #{enabled,jdbcType=BIT},
            </if>
            <if test="content != null">
                content = #{content,jdbcType=LONGVARBINARY},
            </if>
            <if test="coverImg != null">
                cover_img = #{coverImg,jdbcType=VARCHAR},
            </if>
        </set>
        where block_id = #{blockId,jdbcType=BIGINT}
    </update>


    <select id="listSimpleBlock" resultType="map">
        SELECT
            block_id,
            block_name,
            sort_order
        FROM block
        WHERE block.enabled = TRUE
        ORDER BY block.modified_at;
    </select>

    <select id="listBlockBySortExcludeSelf" resultMap="BaseResultMap">
        SELECT
            block_id,
            sort_order
        FROM `block`
        WHERE `block`.enabled = TRUE AND `block`.sort_order &gt;= #{sortOrder} AND `block`.block_id != #{blockId};
    </select>

    <select id="listBlockBySort" resultMap="BaseResultMap">
        SELECT
            block_id,
            sort_order
        FROM `block`
        WHERE `block`.enabled = TRUE AND `block`.sort_order &gt;= #{sortOrder};
    </select>

    <update id="batchUpdateSort" parameterType="java.util.List">
        update `block`
        SET sort_order = sort_order +1
        where `block`.block_id IN
        <foreach close=")" collection="list" index="index" item="item" open="(" separator=",">
            #{item.blockId}
        </foreach>
        AND `block`.enabled = TRUE;
    </update>

    <update id="batchUpdateBlock">
        update block
        <set>
            <!--<if test="colum.blockName != null">-->
            <!--block_name = #{blockName,jdbcType=VARCHAR},-->
            <!--</if>-->
            <!--<if test="colum.status != null">-->
            <!--status = #{status,jdbcType=TINYINT},-->
            <!--</if>-->
            <!--<if test="colum.title != null">-->
            <!--title = #{title,jdbcType=VARCHAR},-->
            <!--</if>-->
            status = #{status,jdbcType=TINYINT},
            modified_at = now()
            <!--<if test="colum.bgColor != null">-->
            <!--bg_color = #{bgColor,jdbcType=CHAR},-->
            <!--</if>-->
            <!--<if test="colum.subtitle != null">-->
            <!--subtitle = #{subtitle,jdbcType=VARCHAR},-->
            <!--</if>-->
            <!--<if test="colum.titleEnglish != null">-->
            <!--title_english = #{titleEnglish,jdbcType=VARCHAR},-->
            <!--</if>-->
            <!--<if test="colum.enabled != null">-->
            <!--enabled = #{enabled,jdbcType=BIT},-->
            <!--</if>-->
            <!--<if test="colum.content != null">-->
            <!--content = #{content,jdbcType=LONGVARBINARY},-->
            <!--</if>-->
            <!--<if test="colum.coverImg != null">-->
            <!--cover_img = #{coverImg,jdbcType=VARCHAR},-->
            <!--</if>-->
        </set>
        WHERE block_id IN
        <foreach item="item" index="index" collection="blockList" open="(" separator="," close=")">
            #{item.blockId}
        </foreach>
        AND enabled = TRUE;
    </update>


    <!--<update id="updateBatch" parameterType="list">-->
    <!--update block-->
    <!--<trim prefix="set" suffixOverrides=",">-->
    <!--<trim prefix="peopleId =case" suffix="end,">-->
    <!--<foreach collection="list" item="i" index="index">-->
    <!--<if test="i.peopleId!=null">-->
    <!--when id=#{i.id} then #{i.peopleId}-->
    <!--</if>-->
    <!--</foreach>-->
    <!--</trim>-->
    <!--<trim prefix=" roadgridid =case" suffix="end,">-->
    <!--<foreach collection="list" item="i" index="index">-->
    <!--<if test="i.roadgridid!=null">-->
    <!--when id=#{i.id} then #{i.roadgridid}-->
    <!--</if>-->
    <!--</foreach>-->
    <!--</trim>-->

    <!--<trim prefix="type =case" suffix="end,">-->
    <!--<foreach collection="list" item="i" index="index">-->
    <!--<if test="i.type!=null">-->
    <!--when id=#{i.id} then #{i.type}-->
    <!--</if>-->
    <!--</foreach>-->
    <!--</trim>-->
    <!--<trim prefix="unitsid =case" suffix="end,">-->
    <!--<foreach collection="list" item="i" index="index">-->
    <!--<if test="i.unitsid!=null">-->
    <!--when id=#{i.id} then #{i.unitsid}-->
    <!--</if>-->
    <!--</foreach>-->
    <!--</trim>-->
    <!--</trim>-->
    <!--where-->
    <!--<foreach collection="list" separator="or" item="i" index="index">-->
    <!--id=#{i.id}-->
    <!--</foreach>-->
    <!--</update>-->

    <select id="listAllBlock" resultMap="BaseResultMap">
        SELECT
            block_id,
            block_name,
            status,
            title,
            title_english,
            subtitle,
            content,
            bg_color,
            text_color,
            sort_order,
            create_at,
            modified_at,
            enabled,
            cover_img
        FROM `block`
        WHERE `block`.enabled = TRUE;
    </select>

    <select id="getBlockByName" parameterType="com.intramirror.product.api.model.Block" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        ,
        <include refid="Blob_Column_List"/>
        from block
        where block_name = #{blockName,jdbcType=VARCHAR}
    </select>


</mapper>