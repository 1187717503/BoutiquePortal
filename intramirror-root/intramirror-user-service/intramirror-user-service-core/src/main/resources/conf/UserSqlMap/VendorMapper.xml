<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.intramirror.user.core.mapper.VendorMapper">
    <resultMap id="BaseResultMap" type="com.intramirror.user.api.model.Vendor">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <id column="vendor_id" jdbcType="BIGINT" property="vendorId"/>
        <result column="grade" jdbcType="TINYINT" property="grade"/>
        <result column="vendor_name" jdbcType="VARCHAR" property="vendorName"/>
        <result column="vendor_code" jdbcType="VARCHAR" property="vendorCode"/>
        <result column="user_id" jdbcType="BIGINT" property="userId"/>
        <result column="vendor_applicant_id" jdbcType="BIGINT" property="vendorApplicantId"/>
        <result column="identity_card" jdbcType="VARCHAR" property="identityCard"/>
        <result column="brand_type" jdbcType="TINYINT" property="brandType"/>
        <result column="credit_card" jdbcType="VARCHAR" property="creditCard"/>
        <result column="status" jdbcType="TINYINT" property="status"/>
        <result column="company_name" jdbcType="VARCHAR" property="companyName"/>
        <result column="registered_person" jdbcType="VARCHAR" property="registeredPerson"/>
        <result column="electronic_identification_card" jdbcType="VARCHAR" property="electronicIdentificationCard"/>
        <result column="business_license_number" jdbcType="VARCHAR" property="businessLicenseNumber"/>
        <result column="business_license_duration" jdbcType="TIMESTAMP" property="businessLicenseDuration"/>
        <result column="valid_end_at" jdbcType="TIMESTAMP" property="validEndAt"/>
        <result column="electronic_business_license" jdbcType="VARCHAR" property="electronicBusinessLicense"/>
        <result column="legal_management_scope" jdbcType="VARCHAR" property="legalManagementScope"/>
        <result column="business_license_location" jdbcType="VARCHAR" property="businessLicenseLocation"/>
        <result column="updated_at" jdbcType="TIMESTAMP" property="updatedAt"/>
        <result column="created_at" jdbcType="TIMESTAMP" property="createdAt"/>
        <result column="enabled" jdbcType="BIT" property="enabled"/>
        <result column="last_login" jdbcType="TIMESTAMP" property="lastLogin"/>
        <result column="national_mark" jdbcType="VARCHAR" property="nationalMark"/>
        <result column="product_image_score" jdbcType="TINYINT" property="productImageScore"/>
        <result column="vendor_score" jdbcType="TINYINT" property="vendorScore"/>
        <result column="score" jdbcType="DECIMAL" property="score"/>
        <result column="address_country_id" jdbcType="BIGINT" property="addressCountryId"/>
        <result column="remark" jdbcType="VARCHAR" property="remark"/>
        <result column="skip_confirm" jdbcType="TINYINT" property="skipConfirm"/>
        <result column="parent_id" jdbcType="BIGINT" property="parentId"/>
        <result column="erp_system" jdbcType="VARCHAR" property="erpSystem"/>
        <result column="contact_phone" jdbcType="VARCHAR" property="contactPhone"/>
        <result column="postal_code" jdbcType="VARCHAR" property="postalCode"/>
        <result column="contact_email" jdbcType="VARCHAR" property="contactEmail"/>
        <result column="contact" jdbcType="VARCHAR" property="contact"/>
        <result column="area_code" jdbcType="VARCHAR" property="areaCode"/>
        <result column="city" jdbcType="VARCHAR" property="city"/>

    </resultMap>
    <sql id="selectColumn">
    vendor_id, grade, vendor_name,vendor_code, user_id,parent_id, vendor_applicant_id, identity_card, brand_type,
    credit_card, status, company_name, registered_person, electronic_identification_card, 
    business_license_number, business_license_duration, valid_end_at, electronic_business_license, 
    legal_management_scope, business_license_location, updated_at, created_at, enabled, 
    last_login, national_mark, product_image_score, vendor_score, score, address_country_id,remark,skip_confirm,erp_system,
    contact_phone,postal_code,contact_email,area_code,city,contact
  </sql>
    <sql id="selectTable">
    vendor v
  </sql>
    <select id="getVendorListByUserIdAndEnabled" resultMap="BaseResultMap">
        SELECT
        <include refid="selectColumn"/>
        FROM
        <include refid="selectTable"/>
        WHERE
        v.user_id =#{userId}
        AND
        v.enabled=#{enabled}
    </select>

    <select id="getChildVendorListByUserIdAndEnabled" resultMap="BaseResultMap">
            SELECT
            <include refid="selectColumn"/>
            FROM
            <include refid="selectTable"/>
            WHERE
            (v.user_id =#{userId} or v.parent_id in (select t.vendor_id from vendor t WHERE t.user_id=#{userId}))
            AND
            v.enabled=#{enabled}
        </select>

    <select id="queryAllVendor" resultType="java.util.Map" parameterType="java.util.Map">

        select vendor_id,vendor_name,user_id from vendor v where v.enabled = 1 order by vendor_name
    </select>

    <select id="queryVendorByIds" resultMap="BaseResultMap" parameterType="java.util.Map">
        select vendor_id,vendor_name from vendor v where v.enabled = 1
        AND vendor_id IN
        <foreach collection="ids" item="ids" index="index"
                 open="(" close=")" separator=",">
            #{ids}
        </foreach>
        ORDER BY vendor_name ASC
    </select>

    <select id="queryRuleVendor" resultType="java.util.Map" parameterType="java.util.Map">

        select vendor_id,vendor_name,user_id from vendor v where v.vendor_id in (
        select distinct vendor_id from price_change_rule pcr
        where pcr.price_type = #{price_type,jdbcType=INTEGER} and pcr.`status` = #{status,jdbcType=INTEGER}
        <if test="categoryType != null">
            and pcr.category_type = #{categoryType,jdbcType=INTEGER}
        </if>
        ) and v.enabled = 1
    </select>

    <select id="queryVendorByVendorId" resultMap="BaseResultMap" parameterType="java.util.Map">

        select
        <include refid="selectColumn"/>
        from vendor v where v.enabled = 1 and v.vendor_id = #{vendor_id,jdbcType=INTEGER}
    </select>

    <select id="getProductSkuVendorIdMap" resultType="java.util.HashMap">
        select sps.shop_product_sku_id, v.vendor_id
        from shop_product_sku sps
        inner join shop_product sp on sps.shop_product_id = sp.shop_product_id
        inner join product p on sp.product_id = p.product_id
        inner join vendor v
        on p.vendor_id = v.vendor_id
        where sps.shop_product_sku_id in
        <foreach collection="skuIds" item="skuId" index="index"
                 open="(" close=")" separator=",">
            #{skuId}
        </foreach>
    </select>

    <select id="getAllVendorCountryById" resultType="java.util.HashMap">
        select address_country_id from vendor where vendor_id IN
        <foreach collection="vendorIds" item="vendorId" index="index"
                 open="(" close=")" separator=",">
            #{vendorId}
        </foreach>
    </select>

    <update id="updateByPrimaryKeySelective" parameterType="com.intramirror.user.api.model.Vendor" >
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update vendor
        <set >
            <if test="parentId != null" >
                parent_id = #{parentId,jdbcType=BIGINT},
            </if>
            <if test="vendorCode != null" >
                vendor_code = #{vendorCode,jdbcType=VARCHAR},
            </if>
            <if test="grade != null" >
                grade = #{grade,jdbcType=TINYINT},
            </if>
            <if test="vendorName != null" >
                vendor_name = #{vendorName,jdbcType=VARCHAR},
            </if>
            <if test="userId != null" >
                user_id = #{userId,jdbcType=BIGINT},
            </if>
            <if test="vendorApplicantId != null" >
                vendor_applicant_id = #{vendorApplicantId,jdbcType=BIGINT},
            </if>
            <if test="identityCard != null" >
                identity_card = #{identityCard,jdbcType=VARCHAR},
            </if>
            <if test="brandType != null" >
                brand_type = #{brandType,jdbcType=TINYINT},
            </if>
            <if test="creditCard != null" >
                credit_card = #{creditCard,jdbcType=VARCHAR},
            </if>
            <if test="status != null" >
                status = #{status,jdbcType=TINYINT},
            </if>
            <if test="companyName != null" >
                company_name = #{companyName,jdbcType=VARCHAR},
            </if>
            <if test="registeredPerson != null" >
                registered_person = #{registeredPerson,jdbcType=VARCHAR},
            </if>
            <if test="electronicIdentificationCard != null" >
                electronic_identification_card = #{electronicIdentificationCard,jdbcType=VARCHAR},
            </if>
            <if test="businessLicenseNumber != null" >
                business_license_number = #{businessLicenseNumber,jdbcType=VARCHAR},
            </if>
            <if test="businessLicenseDuration != null" >
                business_license_duration = #{businessLicenseDuration,jdbcType=TIMESTAMP},
            </if>
            <if test="validEndAt != null" >
                valid_end_at = #{validEndAt,jdbcType=TIMESTAMP},
            </if>
            <if test="electronicBusinessLicense != null" >
                electronic_business_license = #{electronicBusinessLicense,jdbcType=VARCHAR},
            </if>
            <if test="legalManagementScope != null" >
                legal_management_scope = #{legalManagementScope,jdbcType=VARCHAR},
            </if>
            <if test="businessLicenseLocation != null" >
                business_license_location = #{businessLicenseLocation,jdbcType=VARCHAR},
            </if>
            <if test="city != null" >
                city = #{city,jdbcType=VARCHAR},
            </if>
            <if test="areaCode != null" >
                area_code = #{areaCode,jdbcType=VARCHAR},
            </if>
            <if test="updatedAt != null" >
                updated_at = #{updatedAt,jdbcType=TIMESTAMP},
            </if>
            <if test="createdAt != null" >
                created_at = #{createdAt,jdbcType=TIMESTAMP},
            </if>
            <if test="enabled != null" >
                enabled = #{enabled,jdbcType=BIT},
            </if>
            <if test="lastLogin != null" >
                last_login = #{lastLogin,jdbcType=TIMESTAMP},
            </if>
            <if test="nationalMark != null" >
                national_mark = #{nationalMark,jdbcType=VARCHAR},
            </if>
            <if test="productImageScore != null" >
                product_image_score = #{productImageScore,jdbcType=TINYINT},
            </if>
            <if test="vendorScore != null" >
                vendor_score = #{vendorScore,jdbcType=TINYINT},
            </if>
            <if test="score != null" >
                score = #{score,jdbcType=DECIMAL},
            </if>
            <if test="addressCountryId != null" >
                address_country_id = #{addressCountryId,jdbcType=BIGINT},
            </if>
            <if test="contact != null" >
                contact = #{contact,jdbcType=VARCHAR},
            </if>
            <if test="eddTitle != null" >
                edd_title = #{eddTitle,jdbcType=VARCHAR},
            </if>
            <if test="eddDesc != null" >
                edd_desc = #{eddDesc,jdbcType=VARCHAR},
            </if>
            <if test="skipConfirm != null" >
                skip_confirm = #{skipConfirm,jdbcType=TINYINT},
            </if>
            <if test="erpSystem != null" >
                erp_system = #{erpSystem,jdbcType=VARCHAR},
            </if>
            <if test="contactPhone != null" >
                contact_phone = #{contactPhone,jdbcType=VARCHAR},
            </if>
            <if test="postalCode != null" >
                postal_code = #{postalCode,jdbcType=VARCHAR},
            </if>
            <if test="contactEmail != null" >
                contact_email = #{contactEmail,jdbcType=VARCHAR},
            </if>
            <if test="remark != null" >
                remark = #{remark,jdbcType=LONGVARCHAR},
            </if>
        </set>
        where vendor_id = #{vendorId,jdbcType=BIGINT}
    </update>

    <select id="selectAllowImportProductByVendorId" resultType="java.lang.Long">
        select allow_import_product from vendor_job_config where vendor_id = #{vendorId};
    </select>
    <select id="selectVendorProperty" resultType="java.lang.String" parameterType="string">
        SELECT system_property_value FROM system_property WHERE system_property_name = #{propertyKey}
    </select>
</mapper>