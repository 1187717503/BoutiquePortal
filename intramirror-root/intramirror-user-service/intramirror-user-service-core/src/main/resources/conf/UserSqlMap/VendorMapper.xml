<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.intramirror.user.core.mapper.VendorMapper">
    <resultMap id="BaseResultMap" type="com.intramirror.user.api.model.Vendor">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <id column="vendor_id" jdbcType="BIGINT" property="vendorId"/>
        <result column="grade" jdbcType="TINYINT" property="grade"/>
        <result column="vendor_name" jdbcType="VARCHAR" property="vendorName"/>
        <result column="user_id" jdbcType="BIGINT" property="userId"/>
        <result column="vendor_applicant_id" jdbcType="BIGINT" property="vendorApplicantId"/>
        <result column="identity_card" jdbcType="VARCHAR" property="identityCard"/>
        <result column="brand_type" jdbcType="TINYINT" property="brandType"/>
        <result column="credit_card" jdbcType="VARCHAR" property="creditCard"/>
        <result column="status" jdbcType="TINYINT" property="status"/>
        <result column="company_name" jdbcType="VARCHAR" property="companyName"/>
        <result column="registered_person" jdbcType="VARCHAR" property="registeredPerson"/>
        <result column="electronic_identification_card" jdbcType="VARCHAR" property="electronicIdentificationCard"/>
        <result column="business_license_number" jdbcType="VARCHAR" property="businessLicenseNumber"/>
        <result column="business_license_duration" jdbcType="TIMESTAMP" property="businessLicenseDuration"/>
        <result column="valid_end_at" jdbcType="TIMESTAMP" property="validEndAt"/>
        <result column="electronic_business_license" jdbcType="VARCHAR" property="electronicBusinessLicense"/>
        <result column="legal_management_scope" jdbcType="VARCHAR" property="legalManagementScope"/>
        <result column="business_license_location" jdbcType="VARCHAR" property="businessLicenseLocation"/>
        <result column="updated_at" jdbcType="TIMESTAMP" property="updatedAt"/>
        <result column="created_at" jdbcType="TIMESTAMP" property="createdAt"/>
        <result column="enabled" jdbcType="BIT" property="enabled"/>
        <result column="last_login" jdbcType="TIMESTAMP" property="lastLogin"/>
        <result column="national_mark" jdbcType="VARCHAR" property="nationalMark"/>
        <result column="product_image_score" jdbcType="TINYINT" property="productImageScore"/>
        <result column="vendor_score" jdbcType="TINYINT" property="vendorScore"/>
        <result column="score" jdbcType="DECIMAL" property="score"/>
        <result column="address_country_id" jdbcType="BIGINT" property="addressCountryId"/>
        <result column="remark" jdbcType="VARCHAR" property="remark"/>
        <result column="skip_confirm" jdbcType="TINYINT" property="skipConfirm"/>
    </resultMap>
    <sql id="selectColumn">
    vendor_id, grade, vendor_name, user_id, vendor_applicant_id, identity_card, brand_type,
    credit_card, status, company_name, registered_person, electronic_identification_card, 
    business_license_number, business_license_duration, valid_end_at, electronic_business_license, 
    legal_management_scope, business_license_location, updated_at, created_at, enabled, 
    last_login, national_mark, product_image_score, vendor_score, score, address_country_id,remark,skip_confirm
  </sql>
    <sql id="selectTable">
    vendor v
  </sql>
    <select id="getVendorListByUserIdAndEnabled" resultMap="BaseResultMap">
        SELECT
        <include refid="selectColumn"/>
        FROM
        <include refid="selectTable"/>
        WHERE
        v.user_id =#{userId}
        AND
        v.enabled=#{enabled}
    </select>

    <select id="queryAllVendor" resultType="java.util.Map" parameterType="java.util.Map">

        select vendor_id,vendor_name,user_id from vendor v where v.enabled = 1 order by vendor_name
    </select>

    <select id="queryVendorByIds" resultMap="BaseResultMap" parameterType="java.util.Map">
        select vendor_id,vendor_name from vendor v where v.enabled = 1
        AND vendor_id IN
        <foreach collection="ids" item="ids" index="index"
                 open="(" close=")" separator=",">
            #{ids}
        </foreach>
    </select>

    <select id="queryRuleVendor" resultType="java.util.Map" parameterType="java.util.Map">

        select vendor_id,vendor_name,user_id from vendor v where v.vendor_id in (
        select distinct vendor_id from price_change_rule pcr
        where pcr.price_type = #{price_type,jdbcType=INTEGER} and pcr.`status` = #{status,jdbcType=INTEGER}
        <if test="categoryType != null">
            and pcr.category_type = #{categoryType,jdbcType=INTEGER}
        </if>
        ) and v.enabled = 1
    </select>

    <select id="queryVendorByVendorId" resultMap="BaseResultMap" parameterType="java.util.Map">

        select
        <include refid="selectColumn"/>
        from vendor v where v.enabled = 1 and v.vendor_id = #{vendor_id,jdbcType=INTEGER}
    </select>

    <select id="getProductSkuVendorIdMap" resultType="java.util.HashMap">
        select sps.shop_product_sku_id, v.vendor_id
        from shop_product_sku sps
        inner join shop_product sp on sps.shop_product_id = sp.shop_product_id
        inner join product p on sp.product_id = p.product_id
        inner join vendor v
        on p.vendor_id = v.vendor_id
        where sps.shop_product_sku_id in
        <foreach collection="skuIds" item="skuId" index="index"
                 open="(" close=")" separator=",">
            #{skuId}
        </foreach>
    </select>

    <select id="getAllVendorCountryById" resultType="java.util.HashMap">
        select address_country_id from vendor where vendor_id IN
        <foreach collection="vendorIds" item="vendorId" index="index"
                 open="(" close=")" separator=",">
            #{vendorId}
        </foreach>
    </select>

</mapper>