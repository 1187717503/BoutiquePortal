<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.intramirror.main.core.mapper.TaxMapper">
    <resultMap id="BaseResultMap" type="com.intramirror.main.api.model.Tax">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <id column="tax_id" property="taxId" jdbcType="INTEGER"/>
        <result column="tax_type" property="taxType" jdbcType="INTEGER"/>
        <result column="tax_rate" property="taxRate" jdbcType="DECIMAL"/>
        <result column="markup_rate" property="markupRate" jdbcType="DECIMAL"/>
        <result column="tax_number" property="taxNumber" jdbcType="VARCHAR"/>
        <result column="tax_product_category" property="taxProductCategory" jdbcType="VARCHAR"/>
        <result column="tax_reference_amt" property="taxReferenceAmt" jdbcType="DECIMAL"/>
        <result column="tax_reference_currency" property="taxReferenceCurrency" jdbcType="VARCHAR"/>
        <result column="category_id" property="categoryId" jdbcType="BIGINT"/>
        <result column="address_country_id" property="addressCountryId" jdbcType="BIGINT"/>
    </resultMap>
    <sql id="Base_Column_List">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        tax_id, tax_type, tax_rate, markup_rate, tax_number, tax_product_category, tax_reference_amt,
        tax_reference_currency, category_id, address_country_id
    </sql>
    <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select
        <include refid="Base_Column_List"/>
        from tax
        where tax_id = #{taxId,jdbcType=INTEGER}
    </select>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        delete from tax
        where tax_id = #{taxId,jdbcType=INTEGER}
    </delete>
    <insert id="insert" parameterType="com.intramirror.main.api.model.Tax">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into tax (tax_id, tax_type, tax_rate,
        markup_rate, tax_number, tax_product_category,
        tax_reference_amt, tax_reference_currency,
        category_id, address_country_id)
        values (#{taxId,jdbcType=INTEGER}, #{taxType,jdbcType=INTEGER}, #{taxRate,jdbcType=DECIMAL},
        #{markupRate,jdbcType=DECIMAL}, #{taxNumber,jdbcType=VARCHAR}, #{taxProductCategory,jdbcType=VARCHAR},
        #{taxReferenceAmt,jdbcType=DECIMAL}, #{taxReferenceCurrency,jdbcType=VARCHAR},
        #{categoryId,jdbcType=BIGINT}, #{addressCountryId,jdbcType=BIGINT})
    </insert>
    <insert id="insertSelective" parameterType="com.intramirror.main.api.model.Tax">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into tax
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="taxId != null">
                tax_id,
            </if>
            <if test="taxType != null">
                tax_type,
            </if>
            <if test="taxRate != null">
                tax_rate,
            </if>
            <if test="markupRate != null">
                markup_rate,
            </if>
            <if test="taxNumber != null">
                tax_number,
            </if>
            <if test="taxProductCategory != null">
                tax_product_category,
            </if>
            <if test="taxReferenceAmt != null">
                tax_reference_amt,
            </if>
            <if test="taxReferenceCurrency != null">
                tax_reference_currency,
            </if>
            <if test="categoryId != null">
                category_id,
            </if>
            <if test="addressCountryId != null">
                address_country_id,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="taxId != null">
                #{taxId,jdbcType=INTEGER},
            </if>
            <if test="taxType != null">
                #{taxType,jdbcType=INTEGER},
            </if>
            <if test="taxRate != null">
                #{taxRate,jdbcType=DECIMAL},
            </if>
            <if test="markupRate != null">
                #{markupRate,jdbcType=DECIMAL},
            </if>
            <if test="taxNumber != null">
                #{taxNumber,jdbcType=VARCHAR},
            </if>
            <if test="taxProductCategory != null">
                #{taxProductCategory,jdbcType=VARCHAR},
            </if>
            <if test="taxReferenceAmt != null">
                #{taxReferenceAmt,jdbcType=DECIMAL},
            </if>
            <if test="taxReferenceCurrency != null">
                #{taxReferenceCurrency,jdbcType=VARCHAR},
            </if>
            <if test="categoryId != null">
                #{categoryId,jdbcType=BIGINT},
            </if>
            <if test="addressCountryId != null">
                #{addressCountryId,jdbcType=BIGINT},
            </if>
        </trim>
    </insert>
    <update id="updateByPrimaryKeySelective" parameterType="com.intramirror.main.api.model.Tax">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update tax
        <set>
            <if test="taxType != null">
                tax_type = #{taxType,jdbcType=INTEGER},
            </if>
            <if test="taxRate != null">
                tax_rate = #{taxRate,jdbcType=DECIMAL},
            </if>
            <if test="markupRate != null">
                markup_rate = #{markupRate,jdbcType=DECIMAL},
            </if>
            <if test="taxNumber != null">
                tax_number = #{taxNumber,jdbcType=VARCHAR},
            </if>
            <if test="taxProductCategory != null">
                tax_product_category = #{taxProductCategory,jdbcType=VARCHAR},
            </if>
            <if test="taxReferenceAmt != null">
                tax_reference_amt = #{taxReferenceAmt,jdbcType=DECIMAL},
            </if>
            <if test="taxReferenceCurrency != null">
                tax_reference_currency = #{taxReferenceCurrency,jdbcType=VARCHAR},
            </if>
            <if test="categoryId != null">
                category_id = #{categoryId,jdbcType=BIGINT},
            </if>
            <if test="addressCountryId != null">
                address_country_id = #{addressCountryId,jdbcType=BIGINT},
            </if>
        </set>
        where tax_id = #{taxId,jdbcType=INTEGER}
    </update>
    <update id="updateByPrimaryKey" parameterType="com.intramirror.main.api.model.Tax">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update tax
        set tax_type = #{taxType,jdbcType=INTEGER},
        tax_rate = #{taxRate,jdbcType=DECIMAL},
        markup_rate = #{markupRate,jdbcType=DECIMAL},
        tax_number = #{taxNumber,jdbcType=VARCHAR},
        tax_product_category = #{taxProductCategory,jdbcType=VARCHAR},
        tax_reference_amt = #{taxReferenceAmt,jdbcType=DECIMAL},
        tax_reference_currency = #{taxReferenceCurrency,jdbcType=VARCHAR},
        category_id = #{categoryId,jdbcType=BIGINT},
        address_country_id = #{addressCountryId,jdbcType=BIGINT}
        where tax_id = #{taxId,jdbcType=INTEGER}
    </update>

    <select id="getTaxByCategoryId" resultType="java.util.HashMap">
        SELECT t.* , c.category_id as input_id FROM tax t
        LEFT JOIN category c ON c.parent_id = t.category_id
        WHERE c.category_id IN
        <foreach collection="categoryIds" item="categoryId" index="index"
                 open="(" close=")" separator=",">
            #{categoryId}
        </foreach>
        AND t.tax_type = #{taxType}
    </select>

    <select id="getTaxRateListById" resultType="java.util.HashMap">
        SELECT tax_rate,markup_rate,tax_id
        FROM tax
        WHERE address_country_id = #{fromCountryId} AND tax_type = #{taxType}
    </select>

    <select id="getTaxByAddressCountryId" resultMap="BaseResultMap" parameterType="java.lang.Long">
        select
        <include refid="Base_Column_List"/>
        from tax
        where address_country_id = #{addressCountryId,jdbcType=BIGINT} and tax_type = 1
    </select>

    <select id="queryCountryId" resultType="map" parameterType="string">
        SELECT v.address_country_id consignorCountryId,ac.geography_id consignorGeographyId,
        l.address_country_id consigneeCountryId,ac1.geography_id consigneeGeographyId,t.tax_rate taxRate
        FROM logistics_product lp
        INNER JOIN vendor v on v.vendor_id = lp.vendor_id
        INNER JOIN logistics l on l.order_logistics_id = lp.order_logistics_id
        INNER JOIN address_country ac on ac.address_country_id = v.address_country_id
        INNER JOIN address_country ac1 on ac1.address_country_id = l.address_country_id
        LEFT JOIN tax t on (t.address_country_id = v.address_country_id and t.tax_type = 1)
        WHERE lp.order_line_num = #{orderLineNum}
    </select>

    <select id="calculateDiscountTax" resultMap="BaseResultMap" parameterType="string">
        SELECT t.* from tax t
        INNER JOIN vendor v ON v.address_country_id = t.address_country_id
        INNER JOIN logistics_product lp on lp.vendor_id = v.vendor_id
        WHERE lp.order_line_num = #{orderLineNum} and t.tax_type = 1 limit 1;
    </select>
</mapper>